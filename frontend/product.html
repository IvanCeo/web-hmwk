<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Карточка товара — Ламповый магазин</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-700 min-h-screen text-white font-sans">

  <!-- Навигация -->
  <nav class="bg-gray-800 px-6 py-4 flex justify-between items-center shadow-xl">
    <div class="flex items-center gap-3">
      <!-- SVG логотип -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="36" height="36" class="text-cyan-400 drop-shadow">
        <path d="M12 .75a8.25 8.25 0 0 0-4.135 15.39c.686.398 1.115 1.008 1.134 1.623a.75.75 0 0 0 .577.706c.352.083.71.148 1.074.195.323.041.6-.218.6-.544v-4.661a6.714 6.714 0 0 1-.937-.171.75.75 0 1 1 .374-1.453 5.261 5.261 0 0 0 2.626 0 .75.75 0 1 1 .374 1.452 6.712 6.712 0 0 1-.937.172v4.66c0 .327.277.586.6.545.364-.047.722-.112 1.074-.195a.75.75 0 0 0 .577-.706c.02-.615.448-1.225 1.134-1.623A8.25 8.25 0 0 0 12 .75Z"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.013 19.9a.75.75 0 0 1 .877-.597 11.319 11.319 0 0 0 4.22 0 .75.75 0 1 1 .28 1.473 12.819 12.819 0 0 1-4.78 0 .75.75 0 0 1-.597-.876ZM9.754 22.344a.75.75 0 0 1 .824-.668 13.682 13.682 0 0 0 2.844 0 .75.75 0 1 1 .156 1.492 15.156 15.156 0 0 1-3.156 0 .75.75 0 0 1-.668-.824Z"/>
      </svg>
      <span class="text-2xl font-bold tracking-wide">ЛамповыйЗавод</span>
    </div>
    <div class="flex gap-4 items-center">
      <a href="index.html" class="hover:text-cyan-400 transition">Каталог</a>
      <a href="contacts.html" class="hover:text-cyan-400 transition">Контакты</a>
      <a href="order.html" class="hover:text-cyan-400 transition">Заказ</a>
      <a href="login.html" class="ml-4 px-4 py-1 bg-cyan-400 text-gray-900 rounded-lg font-bold hover:bg-cyan-300 transition">Вход</a>
    </div>
  </nav>

  <!-- Контент -->
  <main class="container mx-auto px-4 md:px-0 mt-12 flex flex-col items-center">
    <div id="product-card" class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl border border-gray-700 p-8 flex flex-col md:flex-row gap-10">
      <div class="flex-1 flex items-center justify-center">
        <img id="product-image" src="" alt="Изображение товара" class="rounded-2xl object-contain w-full max-h-96 bg-gray-900 shadow-inner">
      </div>
      <div class="flex-1 flex flex-col gap-6">
        <div>
          <h1 id="product-name" class="text-3xl font-bold text-cyan-400 mb-2">...</h1>
          <p id="product-price" class="text-2xl font-semibold text-white mb-2">...</p>
        </div>
        <div>
          <h4 class="text-lg text-gray-300 mb-1">Описание:</h4>
          <p id="product-description" class="text-gray-200"></p>
        </div>
        <div class="flex items-center gap-3 text-gray-400">
          <span>В наличии:</span>
          <span id="product-stock" class="text-cyan-400 font-bold">...</span>
          <span>шт.</span>
        </div>
        <div class="flex items-center gap-4 mt-6">
          <input id="quantity-input" type="number" min="1" value="1" class="w-20 px-2 py-2 rounded-lg bg-gray-900 border border-gray-700 text-white focus:border-cyan-400 focus:outline-none" />
          <button id="add-to-cart-btn" class="px-6 py-2 rounded-lg bg-cyan-400 text-gray-900 font-bold hover:bg-cyan-300 transition disabled:bg-gray-600 disabled:text-gray-400">
            Добавить в заказ
          </button>
        </div>
        <div id="cart-toast" class="hidden mt-2 text-cyan-400 font-semibold text-sm"></div>
      </div>
    </div>
  </main>

  <!-- Футер -->
  <footer class="mt-12 p-4 bg-gray-900 text-center text-sm text-gray-400 rounded-t-2xl shadow-inner">
    2025 © Ламповый завод — фабрика по производству ламп различного назначения.
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      const qtyInput = document.getElementById('quantity-input');
      const btn = document.getElementById('add-to-cart-btn');
      const toast = document.getElementById('cart-toast');

      if (!id) {
        alert('Не указан ID товара');
        return;
      }

      axios.get(`/api/v1/products/${id}`)
        .then(({ data: p }) => {
          document.getElementById('product-name').textContent = p.name;
          document.getElementById('product-price').textContent = `${p.price} руб.`;
          document.getElementById('product-description').textContent = p.description;
          document.getElementById('product-stock').textContent = p.stock_quantity;
          document.getElementById('product-image').src = p.image_url;
          document.getElementById('product-image').alt = p.name;
          qtyInput.max = p.stock_quantity;
          if (p.stock_quantity === 0) {
            qtyInput.value = 0;
            qtyInput.disabled = true;
            btn.disabled = true;
          }
          btn.addEventListener('click', () => {
            let q = parseInt(qtyInput.value, 10) || 1;
            if (q < 1) q = 1;
            if (q > p.stock_quantity) {
              toast.textContent = `Максимально доступно ${p.stock_quantity} шт.`;
              toast.classList.remove('hidden');
              qtyInput.value = p.stock_quantity;
              setTimeout(() => toast.classList.add('hidden'), 2000);
              return;
            }
            let cart = sessionStorage.getItem('cart');
            cart = cart ? JSON.parse(cart) : [];
            const exist = cart.find(i => i.product_id === p.id);
            if (exist) {
              exist.quantity += q;
            } else {
              cart.push({ product_id: p.id, quantity: q });
            }
            sessionStorage.setItem('cart', JSON.stringify(cart));
            toast.textContent = `${p.name} (${q} шт.) добавлен в заказ`;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2000);
          });
        })
        .catch(err => {
          console.error('Ошибка загрузки товара:', err);
          alert('Не удалось загрузить данные товара.');
        });
    });
  </script>
</body>
</html>
